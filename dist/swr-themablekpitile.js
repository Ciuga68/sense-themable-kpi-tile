define(["jquery","underscore","./properties","./lib/js/extensionUtils","text!./lib/partials/template.ng.html","text!./lib/css/style.css","text!./config/layouts.json"],function($,_,props,extensionUtils,ngTemplate,cssContent,layoutsText){"use strict";extensionUtils.addStyleToHeader(cssContent,"swr-themablekpitile");var layouts=JSON.parse(layoutsText);return{initialproperties:{showTitles:!1},definition:props,snapshot:{canTakeSnapshot:!0},template:ngTemplate,controller:["$scope","$element","$sce",function($scope,$element,$sce){function getKpiComparisonColor(){return $scope.get($scope.layout.props.kpiComparison>0?"comparisonPositiveColor":$scope.layout.props.kpiComparison<0?"comparisonNegativeColor":"comparisonNeutralColor")}function setKpiIcon(){console.log("kpiComparison",$scope.layout.props.kpiComparison),console.log("$scope.layout",$scope.layout),$scope.kpiIcon=$sce.trustAsHtml($scope.layout.props.kpiComparison>0?$scope.get("comparisonPositiveIcon"):$scope.layout.props.kpiComparison<0?$scope.get("comparisonNegativeIcon"):$scope.get("comparisonNeutralIcon"))}console.log("$scope",$scope),$scope.get=function(key){var defaults={tileBackgroundColor:"#F8F8F8",titleColor:"#333333",comparisonPositiveColor:"#006600",comparisonNegativeColor:"#CC0000",comparisonNeutralColor:"#333333",comparisonPositiveIcon:"&#9650;",comparisonNegativeIcon:"&#9660;",comparisonNeutralIcon:"&#9654;"};switch($scope.layout.props.layoutMode){case"default":return defaults[key];case"custom":return $scope.layout.props[key];case"template":var selectedTemplate=$scope.layout.props.layoutTemplate;return layouts[selectedTemplate][key]}},$scope.setStyles=function(){console.log("setStyles >> height",$element.height());var padding=14,elemHeight=$element.height()-padding;$scope.tileStyle={backgroundColor:$scope.get("tileBackgroundColor")},$scope.titleStyle={color:$scope.get("titleColor"),fontSize:Math.max(elemHeight/6,12)+"px"},$scope.kpiStyle={color:$scope.get("kpiColor"),fontSize:Math.max(elemHeight/4,12)+"px",paddingTop:Math.max(elemHeight/10)+"px"},$scope.kpiComparison={fontSize:Math.max(elemHeight/6,10)+"px",color:getKpiComparisonColor()},setKpiIcon()},$scope.$watch(function(){return{h:$element.height(),w:$element.width()}},function(newVal,oldVal){(newVal.h!==oldVal.h||newVal.w!==oldVal.w)&&(console.log("element dimensions",{newVal:newVal,oldVal:oldVal}),$scope.setStyles())},!0),$scope.$watch(function(){return{kpiComparison:$scope.layout.props.kpiComparison,layoutMode:$scope.layout.props.layoutMode,layoutTemplate:$scope.layout.props.layoutTemplate}},function(newVal,oldVal){(newVal.kpiComparison!==oldVal.kpiComparison||newVal.layoutMode!==oldVal.layoutMode||newVal.layoutTemplate!==oldVal.layoutTemplate)&&(console.log("watch kpiComparsion",{newVal:newVal,oldVal:oldVal}),$scope.setStyles())},!0),$scope.setStyles()}]}});